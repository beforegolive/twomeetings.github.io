{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-07-14-the-addicting-ci-tool-dangerjs/","result":{"data":{"site":{"siteMetadata":{"title":"上线前夕"}},"markdownRemark":{"id":"64974dba-face-5c03-a2b5-4a73d9b125cd","excerpt":"在开源社区中，danger的使用尤其普遍，它可以拿来自动判断每个人提交的代码合并请求（github中叫Pull Request，下文简称PR，gitlab中叫Merge Request，下文简称MR）是否符合规范，自动化一些费时费力的人工检查，从而保证代码质量，是项目管理的利器。 比如开源项目styled…","html":"<p>在开源社区中，danger的使用尤其普遍，它可以拿来自动判断每个人提交的代码合并请求（github中叫Pull Request，下文简称PR，gitlab中叫Merge Request，下文简称MR）是否符合规范，自动化一些费时费力的人工检查，从而保证代码质量，是项目管理的利器。</p>\n<p>比如开源项目<a href=\"https://github.com/styled-components/styled-components\">styled-componet</a>的这个自动回复机器人就是用danger实现的。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1be170cd1107e06582b6cd6ab6d9837a/36d41/dangerjs-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzElEQVQY031QWa6DMAzk/hfhQhyhIrSE7ISszIsDrdqfZ2nkJeOxnWEcR0zTBK015nkGmxkYY1j5Cs451vXy27ZBCAHvPY7j+CCEAGttB+UDiS3LglQK9i8yEWOMDZenGjXlnFHKBYpTSjcv9njAbXV3KNTciukmvMWpkfzz+Wr1BB9yRyonvu08K4ZaKyoJKoFoDaRS0Er3L5BSQbXcGAPnHNx9mnIBXHu8hOlfkNrbHtuAXK4N36K/8/633C5RUsJIgf3xwGbbRW37P58hgwnNThBYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 1\"\n        title=\"dangerjs 1\"\n        src=\"/static/1be170cd1107e06582b6cd6ab6d9837a/102e5/dangerjs-1.png\"\n        srcset=\"/static/1be170cd1107e06582b6cd6ab6d9837a/83276/dangerjs-1.png 148w,\n/static/1be170cd1107e06582b6cd6ab6d9837a/ba02f/dangerjs-1.png 295w,\n/static/1be170cd1107e06582b6cd6ab6d9837a/102e5/dangerjs-1.png 590w,\n/static/1be170cd1107e06582b6cd6ab6d9837a/74549/dangerjs-1.png 885w,\n/static/1be170cd1107e06582b6cd6ab6d9837a/7213b/dangerjs-1.png 1180w,\n/static/1be170cd1107e06582b6cd6ab6d9837a/36d41/dangerjs-1.png 1554w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Danger最初是由ruby社区发展起来，之后增加了对js语言的支持，衍生出DangerJs。从它的标语中即可看出此工具存在的意义：<strong>Stop saying “you forgot to …” in code review</strong>，实际上，此工具可做的事情要远比标语中描述的多。</p>\n<p>在整个代码合并流程中，danger的位置通常在测试和代码规范化检查的后一步，人工检查的前一步，相当于是足球中的清道夫的角色，</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/58c881844bb1c1068e57cfe8d3ad1648/291a5/dangerjs-2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIEBv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHZQKuiP//EABgQAQEAAwAAAAAAAAAAAAAAAAIBABIy/9oACAEBAAEFAkrFtcPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhABAQEAAAAAAAAAAAAAAAAAAQAQ/9oACAEBAAY/Akwv/8QAGBABAQEBAQAAAAAAAAAAAAAAAQAhMVH/2gAIAQEAAT8hNDhLY3d7f//aAAwDAQACAAMAAAAQiA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGRABAQEBAQEAAAAAAAAAAAAAAREhAEHB/9oACAEBAAE/ENKQS75w62NMU+81Qqitb3//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 2\"\n        title=\"dangerjs 2\"\n        src=\"/static/58c881844bb1c1068e57cfe8d3ad1648/625aa/dangerjs-2.jpg\"\n        srcset=\"/static/58c881844bb1c1068e57cfe8d3ad1648/c4d45/dangerjs-2.jpg 148w,\n/static/58c881844bb1c1068e57cfe8d3ad1648/1f0d7/dangerjs-2.jpg 295w,\n/static/58c881844bb1c1068e57cfe8d3ad1648/625aa/dangerjs-2.jpg 590w,\n/static/58c881844bb1c1068e57cfe8d3ad1648/f8367/dangerjs-2.jpg 885w,\n/static/58c881844bb1c1068e57cfe8d3ad1648/fab84/dangerjs-2.jpg 1180w,\n/static/58c881844bb1c1068e57cfe8d3ad1648/291a5/dangerjs-2.jpg 2060w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>danger常见的使用场景是：通过自定制的脚本自动化处理一些费神的人工检查。我以前在项目中使用dangerjs在gitlab上实现过这样的检查：合并代码时有没有勾选“合并后删除远端分支”的复选框，有没有勾选“合并时压缩git节点”的复选框，有没有在合并标题中写上对应电子看板的任务卡ID等等，如果没有操作这些则禁止代码合并，及其方便的规范了整个团队的git开发流程。</p>\n<p>在上篇<a href=\"https://juejin.im/post/6847902224794943495\">介绍lerna的文章</a>里，用dangerjs实现了子项目权限检查：判定当前提交人是否满足某个目录的提交权限，不满足则不允许代码合并，效果如下图所示。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb130139d1c77bc7a2e2f33b60db9bc7/cf0ec/dangerjs-3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/2gAMAwEAAhADEAAAAdywxpUf/8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBECEx/9oACAEBAAEFAsbGT2v/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAgUf/aAAgBAQAGPwKL/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAEDFR/9oACAEBAAE/IQhaRLidpvQyf//aAAwDAQACAAMAAAAQC/8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAEDAQE/EJWP/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qp//EAB0QAQABAwUAAAAAAAAAAAAAAAEAESFhEEFRkbH/2gAIAQEAAT8QCAIEVLvMALVuazMep5Jtpf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 3\"\n        title=\"dangerjs 3\"\n        src=\"/static/eb130139d1c77bc7a2e2f33b60db9bc7/625aa/dangerjs-3.jpg\"\n        srcset=\"/static/eb130139d1c77bc7a2e2f33b60db9bc7/c4d45/dangerjs-3.jpg 148w,\n/static/eb130139d1c77bc7a2e2f33b60db9bc7/1f0d7/dangerjs-3.jpg 295w,\n/static/eb130139d1c77bc7a2e2f33b60db9bc7/625aa/dangerjs-3.jpg 590w,\n/static/eb130139d1c77bc7a2e2f33b60db9bc7/f8367/dangerjs-3.jpg 885w,\n/static/eb130139d1c77bc7a2e2f33b60db9bc7/fab84/dangerjs-3.jpg 1180w,\n/static/eb130139d1c77bc7a2e2f33b60db9bc7/cf0ec/dangerjs-3.jpg 2018w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>安装Dangerjs</h3>\n<p>Dangerjs支持github和gitlab两大代码托管平台，也支持私有gitlab服务器，不过它对github的支持最好，简单几步在即可在一个github项目中加入danger检查。</p>\n<p>在你的项目中，dangerjs用起来就像其他任何npm包一样，一行命令即可安装。（注意包名没有js后缀）</p>\n\n        <deckgo-highlight-code language=\"javascript\" >\n          <code slot=\"code\">yarn add -D danger</code>\n        </deckgo-highlight-code>\n      \n<h3>设置github的token</h3>\n<p>danger需要使用你的token授权来做相应操作，比如添加评论到对应的PR下方给出提示。你可以点击<a href=\"https://github.com/settings/tokens/new\">此链接</a>在github上生成对应token，token的名称可以随便起，权限要记得给足。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed5a1644509555ca22c6fdee8b49ca82/e3000/dangerjs-4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwb/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7fRUlDF//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAECIDH/2gAIAQEAAQUCSpHD/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAIQMf/aAAgBAQAGPwI2Nf/EABsQAAIBBQAAAAAAAAAAAAAAAAABERAhQVFh/9oACAEBAAE/IZJb2K+ZHRqo/9oADAMBAAIAAwAAABB/D//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB4QAAIBBAMBAAAAAAAAAAAAAAABESExQXFRYcHh/9oACAEBAAE/EEyrVWI8Fld0/goK57YiG5ayUx7Gf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 4\"\n        title=\"dangerjs 4\"\n        src=\"/static/ed5a1644509555ca22c6fdee8b49ca82/625aa/dangerjs-4.jpg\"\n        srcset=\"/static/ed5a1644509555ca22c6fdee8b49ca82/c4d45/dangerjs-4.jpg 148w,\n/static/ed5a1644509555ca22c6fdee8b49ca82/1f0d7/dangerjs-4.jpg 295w,\n/static/ed5a1644509555ca22c6fdee8b49ca82/625aa/dangerjs-4.jpg 590w,\n/static/ed5a1644509555ca22c6fdee8b49ca82/f8367/dangerjs-4.jpg 885w,\n/static/ed5a1644509555ca22c6fdee8b49ca82/fab84/dangerjs-4.jpg 1180w,\n/static/ed5a1644509555ca22c6fdee8b49ca82/e3000/dangerjs-4.jpg 1400w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>将token保存到环境变量中</h3>\n<p>需要把token的变量名命名为<code>DANGER_GITHUB_API_TOKEN</code>，并且保存在CI的配置里，比如我在github中使用了circleci作为持续集成的工具，token就需要保存到如下位置，见截图：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/330a3/dangerjs-5.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdzYAn//xAAWEAEBAQAAAAAAAAAAAAAAAAAAIRH/2gAIAQEAAQUCyI//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAEDH/2gAIAQEABj8CUP/EAB0QAAECBwAAAAAAAAAAAAAAAAEAUREhMUFhcZH/2gAIAQEAAT8hiFomyA1xCrJl/9oADAMBAAIAAwAAABD0L//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEUH/2gAIAQMBAT8Q5sLf/8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQIBAT8QV//EABsQAQEAAwADAAAAAAAAAAAAABEBADFBIWGx/9oACAEBAAE/EJCH6V+5Zi4c2yaDgPO3uZ//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 5\"\n        title=\"dangerjs 5\"\n        src=\"/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/625aa/dangerjs-5.jpg\"\n        srcset=\"/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/c4d45/dangerjs-5.jpg 148w,\n/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/1f0d7/dangerjs-5.jpg 295w,\n/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/625aa/dangerjs-5.jpg 590w,\n/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/f8367/dangerjs-5.jpg 885w,\n/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/fab84/dangerjs-5.jpg 1180w,\n/static/aa4ca4072fa1ce4f9d8dc5cf6a163ea0/330a3/dangerjs-5.jpg 2686w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>注意，如果是gitlab公网上的项目，那变量名就不一样了，需设置为<code>DANGER_GITLAB_API_TOKEN</code>, 如果是私有gitlab服务器，还需要添加另外一个变量<code>DANGER_GITLAB_HOST</code>将地址指向你自己的服务器，详情可参考<a href=\"https://danger.systems/js/usage/gitlab.html\">官网配置文档</a>。</p>\n<h3>创建dangerfile.js文件</h3>\n<p>项目根目录下创建dangerfile.js文件用于编写对应的脚本，比如下面几行代码就是最常用的写法。</p>\n\n        <deckgo-highlight-code language=\"javascript\" >\n          <code slot=\"code\">import { danger, fail, warn } from &#39;danger&#39;\n\nfail(&#39;This is a failure message&#39;) // 显示一条错误信息\n\nwarn(&#39;This is a warn message&#39;) // 显示一条警告信息\n\nconst { title } = danger.github.pr\nif (!title.startsWith(&#39;feature/&#39;)) {\n\tfail(&#39;标题必须要由&quot;feature/&quot;开头&#39;)\n}</code>\n        </deckgo-highlight-code>\n      \n<h3>本地测试danger脚本</h3>\n<p>在脚本正式推向CI环境前，可以本地测试一下脚本是否符合预期。首先要创建Pull Requst，然后获取此PR的地址，之后使用npm或者yarn执行命令：</p>\n\n        <deckgo-highlight-code  >\n          <code slot=\"code\">yarn danger pr 创建的PR的地址</code>\n        </deckgo-highlight-code>\n      \n<p>此时，你可能会碰到下面这样的提示，这是因为还没有在本地设置token变量。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/52586/dangerjs-6.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.162162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAACABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcZAWIT/xAAXEAADAQAAAAAAAAAAAAAAAAAAATFB/9oACAEBAAEFAscP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEREP/aAAgBAQABPyFK4Kf/2gAMAwEAAgADAAAAEPPP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EHCf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAQEBAQAAAAAAAAAAAAAAASEAETH/2gAIAQEAAT8QBVBbXQkjzdPqu//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 6\"\n        title=\"dangerjs 6\"\n        src=\"/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/625aa/dangerjs-6.jpg\"\n        srcset=\"/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/c4d45/dangerjs-6.jpg 148w,\n/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/1f0d7/dangerjs-6.jpg 295w,\n/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/625aa/dangerjs-6.jpg 590w,\n/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/f8367/dangerjs-6.jpg 885w,\n/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/fab84/dangerjs-6.jpg 1180w,\n/static/f6af9fe4189a62e4f569a4ce5ea7fc8f/52586/dangerjs-6.jpg 1760w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>本地直接执行一下命令来声明变量即可。</p>\n\n        <deckgo-highlight-code  >\n          <code slot=\"code\">export DANGER_GITHUB_API_TOKEN=xxxxxx</code>\n        </deckgo-highlight-code>\n      \n<p>设置token变量后重新执行<code>danger pr</code>的命令。访问对应的PR地址，如果看到下图这样的效果，说明你写的dangerjs脚本生效了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d437f8ce08ac8bfcdc7abaa3b281249c/a9c5d/dangerjs-7.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHudEEUY//EABgQAAMBAQAAAAAAAAAAAAAAAAABAhEg/9oACAEBAAEFAlOcUI//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAACAwEAAAAAAAAAAAAAAAAAARARMaH/2gAIAQEAAT8hQ1JdKKjCMn//2gAMAwEAAgADAAAAEAQ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRABAAEDBQAAAAAAAAAAAAAAAQARMaEhQXGB4f/aAAgBAQABPxCsZQsoXMBrfsgA8JtMiXeZ/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 7\"\n        title=\"dangerjs 7\"\n        src=\"/static/d437f8ce08ac8bfcdc7abaa3b281249c/625aa/dangerjs-7.jpg\"\n        srcset=\"/static/d437f8ce08ac8bfcdc7abaa3b281249c/c4d45/dangerjs-7.jpg 148w,\n/static/d437f8ce08ac8bfcdc7abaa3b281249c/1f0d7/dangerjs-7.jpg 295w,\n/static/d437f8ce08ac8bfcdc7abaa3b281249c/625aa/dangerjs-7.jpg 590w,\n/static/d437f8ce08ac8bfcdc7abaa3b281249c/f8367/dangerjs-7.jpg 885w,\n/static/d437f8ce08ac8bfcdc7abaa3b281249c/fab84/dangerjs-7.jpg 1180w,\n/static/d437f8ce08ac8bfcdc7abaa3b281249c/a9c5d/dangerjs-7.jpg 1886w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>最后，把<code>yarn danger ci</code>或者<code>npm danger ci</code>放在你的CI文件中的合适位置，这样danger就添加完成了。</p>\n<p>另外，你可以申请一个github账号名为’xxxx-bot’，再贴一张机器人图片作为头像，并用此账号的token作为变量来自动回复，最终能让整个效果更显技术含量。 </p>\n<h3>能获取到的数据</h3>\n<p>除了标题之外，danger能获取当前PR中的各种信息字段，比如用户信息、修改的文件、代码审核人、代码合并的配置等等，从下面的截图里包含了一些常用字段。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c57eb4091a0bfd0e9609e9edc587d859/ddb8a/dangerjs-8.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHd3WwkA//EABUQAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAEFAil//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAQAGPwKs2f/EABsQAAEEAwAAAAAAAAAAAAAAAAEAEBEhMVFx/9oACAEBAAE/IbTZyh1h2i1BZ//aAAwDAQACAAMAAAAQY8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAQQDAAAAAAAAAAAAAAABABEhMXEQkbH/2gAIAQEAAT8Q0pFtwUMnfDLQrvsCcupef//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dangerjs 8\"\n        title=\"dangerjs 8\"\n        src=\"/static/c57eb4091a0bfd0e9609e9edc587d859/625aa/dangerjs-8.jpg\"\n        srcset=\"/static/c57eb4091a0bfd0e9609e9edc587d859/c4d45/dangerjs-8.jpg 148w,\n/static/c57eb4091a0bfd0e9609e9edc587d859/1f0d7/dangerjs-8.jpg 295w,\n/static/c57eb4091a0bfd0e9609e9edc587d859/625aa/dangerjs-8.jpg 590w,\n/static/c57eb4091a0bfd0e9609e9edc587d859/f8367/dangerjs-8.jpg 885w,\n/static/c57eb4091a0bfd0e9609e9edc587d859/fab84/dangerjs-8.jpg 1180w,\n/static/c57eb4091a0bfd0e9609e9edc587d859/ddb8a/dangerjs-8.jpg 2268w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>除此之外，<a href=\"https://danger.systems/js/reference.html\">dangerjs的官网</a>也给出了详细的类型数据，你可以根据需要定制符合自己项目需求的检查脚本。</p>\n<h3>结语</h3>\n<p>danger可以在合并代码时提供自定义的合并规则，能规范整个项目的开发流程，把它整合到CI中能帮你自动化很多繁琐的人工检查，无论是开源项目还是日常开发项目，danger都是项目流程管理的利器，一旦试过你就再也戒不掉。</p>\n<blockquote>\n<p><strong>相关资料</strong></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://medium.com/@ivan.ha/integrate-danger-js-in-5-minutes-55515bc5355d\">integrate-danger-js-in-5-minutes</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://danger.systems/js/\">dangerjs官网</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://github.com/twomeetings/lerna-example/pull/3\">文章中的PR地址</a></p>\n</blockquote>","frontmatter":{"title":"试了就戒不掉的CI工具-dangerjs","date":"July 14, 2020","description":null,"cover":{"publicURL":"/static/cover-0845e35192a767f9bc59b60ac3b0ce8f.jpeg"}}}},"pageContext":{"slug":"/2020-07-14-the-addicting-ci-tool-dangerjs/","previous":{"fields":{"slug":"/2020-07-10-you-should-use-lerna-for-sharing-code/"},"frontmatter":{"title":"大前端项目代码重用，也许lerna是最好的选择"}},"next":{"fields":{"slug":"/2020-07-24-how-to-build-captive-portal-with-nodogslash/"},"frontmatter":{"title":"如何搭建类似麦当劳店中需登录认证的wifi"}}}},"staticQueryHashes":["2841359383"]}